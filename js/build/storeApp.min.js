var storeApp = angular.module('storeApp', []);;/*! storeApp 2013-12-27 */
storeApp.factory("ASWECommerceRepository",function($http,$q,$sce){var a=this;return a.itemSearch=function(a){var b=$q.defer(),c=(new Date).toISOString();a=encodeURIComponent(a),c=encodeURIComponent(c.substr(0,c.length-5)+c.substr(c.length-1));var d=["AWSAccessKeyId=AKIAIGCBAUL7ZNU73E3A","AssociateTag=1114-5004-8668","Condition=All","Keywords="+a,"Operation=ItemSearch","ResponseGroup=Images%2CItemAttributes%2COffers%2CEditorialReview","SearchIndex=All","Service=AWSECommerceService","Timestamp="+c,"Version=2011-08-01"],e=d.join("&"),f="GET\nwebservices.amazon.com\n/onca/xml\n"+e,g=CryptoJS.HmacSHA256(f,"QJEqE8+lrMqLxEXOJUlns73hu3qCLCBxRppdbGzN"),h="http://webservices.amazon.com/onca/xml?"+e+"&Signature="+encodeURIComponent(g.toString(CryptoJS.enc.Base64));return h="ba-simple-proxy.php?url="+encodeURIComponent(h),$http.get(h).success(function(a){var c=(new X2JS).xml_str2json(a.contents),d=c.ItemSearchResponse.Items.Item,e=[];_.forEach(d,function(a){e.push({asin:a.ASIN,image:function(a){return a.MediumImage?a.MediumImage?a.MediumImage.URL:a.ImageSets.ImageSet.MediumImage.URL:void 0}(a),imageWidth:function(a){return a.MediumImage?a.MediumImage.Width.__text:void 0}(a),title:a.ItemAttributes.Title,subtitle:function(a){var b=a.ItemAttributes.Author||a.ItemAttributes.Brand;return"object"==typeof b?b.join(", "):b}(a),binding:a.ItemAttributes.Binding,description:function(a){return a.EditorialReviews?$sce.trustAsHtml(a.EditorialReviews.EditorialReview.Content):void 0}(a),price:function(a){return a.OfferSummary&&a.OfferSummary.LowestNewPrice?a.OfferSummary.LowestNewPrice.Amount/100:void 0}(a)})}),b.resolve(e)}),b.promise},a});;/*! storeApp 2013-12-27 */
storeApp.controller("MasterController",function($scope){var a;$scope.addToCart=function(b){a(b)},this.setAddToCartMethod=function(b){a=b},this.cartSiblingElement,this.setCartSiblingElement=function(a){this.cartSiblingElement=a}});;/*! storeApp 2013-12-27 */
storeApp.directive("autoSearchBox",function(ASWECommerceRepository,$timeout){return{restrict:"A",replace:!0,scope:{refreshResults:"&",hideLoader:"&",showLoader:"&"},template:'<input type="text" ng-model="searchParam" placeholder="search" class="form-control" />',link:function(a,b){var c=function(){a.showLoader(),ASWECommerceRepository.itemSearch(a.searchParam).then(function(b){a.hideLoader(),a.refreshResults({items:b})})};a.searchParam="Book",c();var d;b.on("keyup",function(){d&&$timeout.cancel(d),d=$timeout(function(){c()},700)})}}});;/*! storeApp 2013-12-27 */
storeApp.directive("cart",function(){return{require:"^ngController",restrict:"A",templateUrl:"templates/cart.html",scope:{},link:function(a,b,c,d){a.cartShown=!1,a.cartItems=[],a.cartTotal=0,a.toggleCart=function(){a.cartShown=a.cartShown?!1:!0,a.cartShown?e():f()},a.removeFromCart=function(b){_.remove(a.cartItems,function(a){return a.asin==b.asin}),g()};var e=function(){b.addClass("open"),d.cartSiblingElement.addClass("cart-open")},f=function(){b.removeClass("open"),d.cartSiblingElement.removeClass("cart-open")},g=function(){a.cartTotal=0,_.forEach(a.cartItems,function(b){b.price&&(a.cartTotal+=b.price)})},h=function(b){_.contains(_.pluck(a.cartItems,"asin"),b.asin)||(a.cartItems.push(b),g())};d.setAddToCartMethod(h)}}});;/*! storeApp 2013-12-27 */
storeApp.directive("itemList",function($timeout){return{require:"^ngController",restrict:"A",templateUrl:"templates/itemList.html",link:function(a,b,c,d){a.itemList=[],a.loaderShown=!0;var e=document.getElementsByClassName("details-container"),f=document.getElementsByClassName("item-container");a.showLoader=function(){a.loaderShown=!0,a.itemList=[]},a.hideLoader=function(){a.loaderShown=!1},a.refreshItems=function(b){_.forEach(b,function(a){a.showShowMoreLink=!1,a.detailsWidth=370-a.imageWidth}),a.itemList=b},a.$watch("itemList",function(a){$timeout(function(){_.forEach(a,function(a,b){e[b].scrollHeight>160&&(a.showShowMoreLink=!0)})})}),a.showMore=function(b){a.itemList[b].showShowMoreLink=!1,f[b].className+=" expanded",console.log(b)},d.setCartSiblingElement(b)}}});