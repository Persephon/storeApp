var storeApp = angular.module('storeApp', []);;/*! storeApp 2013-12-27 */
storeApp.factory("ASWECommerceRepository",function(a,b,c){var d=this;return d.itemSearch=function(d){var e=b.defer(),f=(new Date).toISOString();d=encodeURIComponent(d),f=encodeURIComponent(f.substr(0,f.length-5)+f.substr(f.length-1));var g=["AWSAccessKeyId=AKIAIGCBAUL7ZNU73E3A","AssociateTag=1114-5004-8668","Condition=All","Keywords="+d,"Operation=ItemSearch","ResponseGroup=Images%2CItemAttributes%2COffers%2CEditorialReview","SearchIndex=All","Service=AWSECommerceService","Timestamp="+f,"Version=2011-08-01"],h=g.join("&"),i="GET\nwebservices.amazon.com\n/onca/xml\n"+h,j=CryptoJS.HmacSHA256(i,"QJEqE8+lrMqLxEXOJUlns73hu3qCLCBxRppdbGzN"),k="http://webservices.amazon.com/onca/xml?"+h+"&Signature="+encodeURIComponent(j.toString(CryptoJS.enc.Base64));return k="ba-simple-proxy.php?url="+encodeURIComponent(k),a.get(k).success(function(a){var b=(new X2JS).xml_str2json(a.contents),d=b.ItemSearchResponse.Items.Item,f=[];_.forEach(d,function(a){f.push({asin:a.ASIN,image:function(a){return a.MediumImage?a.MediumImage?a.MediumImage.URL:a.ImageSets.ImageSet.MediumImage.URL:void 0}(a),imageWidth:function(a){return a.MediumImage?a.MediumImage.Width.__text:void 0}(a),title:a.ItemAttributes.Title,subtitle:function(a){var b=a.ItemAttributes.Author||a.ItemAttributes.Brand;return"object"==typeof b?b.join(", "):b}(a),binding:a.ItemAttributes.Binding,description:function(a){return a.EditorialReviews?c.trustAsHtml(a.EditorialReviews.EditorialReview.Content):void 0}(a),price:function(a){return a.OfferSummary&&a.OfferSummary.LowestNewPrice?a.OfferSummary.LowestNewPrice.Amount/100:void 0}(a)})}),e.resolve(f)}),e.promise},d});;/*! storeApp 2013-12-27 */
storeApp.controller("MasterController",function($scope){var a;$scope.addToCart=function(b){a(b)},this.setAddToCartMethod=function(b){a=b},this.cartSiblingElement,this.setCartSiblingElement=function(a){this.cartSiblingElement=a}});;/*! storeApp 2013-12-27 */
storeApp.directive("autoSearchBox",function(a,b){return{restrict:"A",replace:!0,scope:{refreshResults:"&",hideLoader:"&",showLoader:"&"},template:'<input type="text" ng-model="searchParam" placeholder="search" class="form-control" />',link:function(c,d){var e=function(){c.showLoader(),a.itemSearch(c.searchParam).then(function(a){c.hideLoader(),c.refreshResults({items:a})})};c.searchParam="Book",e();var f;d.on("keyup",function(){f&&b.cancel(f),f=b(function(){e()},700)})}}});;/*! storeApp 2013-12-27 */
storeApp.directive("cart",function(){return{require:"^ngController",restrict:"A",templateUrl:"templates/cart.html",scope:{},link:function(a,b,c,d){a.cartShown=!1,a.cartItems=[],a.cartTotal=0,a.toggleCart=function(){a.cartShown=a.cartShown?!1:!0,a.cartShown?e():f()},a.removeFromCart=function(b){_.remove(a.cartItems,function(a){return a.asin==b.asin}),g()};var e=function(){b.addClass("open"),d.cartSiblingElement.addClass("cart-open")},f=function(){b.removeClass("open"),d.cartSiblingElement.removeClass("cart-open")},g=function(){a.cartTotal=0,_.forEach(a.cartItems,function(b){b.price&&(a.cartTotal+=b.price)})},h=function(b){_.contains(_.pluck(a.cartItems,"asin"),b.asin)||(a.cartItems.push(b),g())};d.setAddToCartMethod(h)}}});;/*! storeApp 2013-12-27 */
storeApp.directive("itemList",function(a){return{require:"^ngController",restrict:"A",templateUrl:"templates/itemList.html",link:function(b,c,d,e){b.itemList=[],b.loaderShown=!0;var f=document.getElementsByClassName("details-container"),g=document.getElementsByClassName("item-container");b.showLoader=function(){b.loaderShown=!0,b.itemList=[]},b.hideLoader=function(){b.loaderShown=!1},b.refreshItems=function(a){_.forEach(a,function(a){a.showShowMoreLink=!1,a.detailsWidth=370-a.imageWidth}),b.itemList=a},b.$watch("itemList",function(b){a(function(){_.forEach(b,function(a,b){f[b].scrollHeight>160&&(a.showShowMoreLink=!0)})})}),b.showMore=function(a){b.itemList[a].showShowMoreLink=!1,g[a].className+=" expanded",console.log(a)},e.setCartSiblingElement(c)}}});